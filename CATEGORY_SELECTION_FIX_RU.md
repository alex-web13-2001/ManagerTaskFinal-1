# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–±—Ä–æ—Å–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞

## üìã –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–≥ –≤—ã–±—Ä–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –æ–Ω–∞ —Å–Ω–∞—á–∞–ª–∞ –≤—ã–±–∏—Ä–∞–ª–∞—Å—å, –Ω–æ –∑–∞—Ç–µ–º –≤—ã–±–æ—Ä —Å–±—Ä–∞—Å—ã–≤–∞–ª—Å—è.

## üîç –ê–Ω–∞–ª–∏–∑

### –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ:
1. –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
2. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –≤ —Ä–∞–∑–¥–µ–ª–µ "–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞"
3. –ö–∞—Ç–µ–≥–æ—Ä–∏—è –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è (—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–π)
4. –ß–µ—Ä–µ–∑ –º–≥–Ω–æ–≤–µ–Ω–∏–µ –≤—ã–±–æ—Ä —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è (–∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ–±—ã—á–Ω–æ–π)

### –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:

–í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ `src/components/project-modal.tsx` –±—ã–ª –Ω–∞–π–¥–µ–Ω –±–∞–≥ –≤ useEffect:

```typescript
// –ü–†–û–ë–õ–ï–ú–ù–´–ô –ö–û–î
const existingProject = projectId && isEditMode ? projects.find(p => p.id === projectId) : null;

React.useEffect(() => {
  if (open && existingProject) {
    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
    setSelectedCategories(projectCategories);
  } else if (open && !isEditMode) {
    // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
    resetForm(); // ‚ùå –≠—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ projects
  }
}, [open, existingProject, isEditMode]); // ‚ùå existingProject –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é ‚Üí `toggleCategory()` –æ–±–Ω–æ–≤–ª—è–µ—Ç `selectedCategories`
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å —Ä–µ-—Ä–µ–Ω–¥–µ—Ä —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
3. –ú–∞—Å—Å–∏–≤ `projects` –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å—Å—è (–¥–∞–∂–µ –µ—Å–ª–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–æ –∂–µ)
4. `existingProject = projects.find(...)` —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é —Å—Å—ã–ª–∫—É (–¥–∞–∂–µ –µ—Å–ª–∏ —ç—Ç–æ `null`)
5. useEffect –≤–∏–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ `existingProject` –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–Ω–æ–≤–∞
6. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `resetForm()` ‚Üí `setSelectedCategories([])` ‚Üí –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω `useRef` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞:

```typescript
const prevOpenRef = React.useRef(false);

React.useEffect(() => {
  // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ (–ø–µ—Ä–µ—Ö–æ–¥ false ‚Üí true)
  if (open && !prevOpenRef.current) {
    if (isEditMode && projectId) {
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
      const project = projects.find(p => p.id === projectId);
      if (project) {
        const projectCategories = (project as any).availableCategories || [];
        setSelectedCategories(projectCategories);
        // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
      }
    } else if (!isEditMode) {
      // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
      resetForm();
    }
  }
  prevOpenRef.current = open;
}, [open, isEditMode, projectId, projects]);
```

### –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

1. **–î–æ–±–∞–≤–ª–µ–Ω ref –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è**: `const prevOpenRef = React.useRef(false)`
2. **–£—Å–ª–æ–≤–∏–µ –∑–∞–ø—É—Å–∫–∞**: `if (open && !prevOpenRef.current)` - –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∏–∑ –∑–∞–∫—Ä—ã—Ç–æ–≥–æ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ref**: `prevOpenRef.current = open` - —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∞
4. **–£–±—Ä–∞–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç existingProject**: –ò—Å–ø–æ–ª—å–∑—É–µ–º `projects.find()` –Ω–∞–ø—Ä—è–º—É—é –≤–Ω—É—Ç—Ä–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è:

‚úÖ **–§–æ—Ä–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑** –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞  
‚úÖ **–ò–∑–º–µ–Ω–µ–Ω–∏—è projects –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç —Ä–µ-–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é** –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ—Ä–º–æ–π  
‚úÖ **–í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è** –≤–æ –≤—Ä–µ–º—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º  
‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤**: —Å–æ–∑–¥–∞–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞  

## üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ ‚úÖ
1. –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç"
2. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é ‚Üí –∫–∞—Ç–µ–≥–æ—Ä–∏—è –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –∏ –æ—Å—Ç–∞—ë—Ç—Å—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π
3. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –µ—â—ë –æ–¥–Ω—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é ‚Üí –æ–±–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏
4. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å/—É–±—Ä–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –±–µ–∑ —Å–±—Ä–æ—Å–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ ‚úÖ
1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ–µ–∫—Ç –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
2. –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å –≤—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π
4. –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ç–∫—Ä—ã—Ç–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è ‚úÖ
1. –û—Ç–∫—Ä—ã—Ç—å ‚Üí –≤—ã–±—Ä–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Üí –∑–∞–∫—Ä—ã—Ç—å
2. –û—Ç–∫—Ä—ã—Ç—å —Å–Ω–æ–≤–∞ ‚Üí —Ñ–æ—Ä–º–∞ —á–∏—Å—Ç–∞—è (–¥–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞)
3. –í—ã–±–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∫–∞–∂–¥—ã–π —Ä–∞–∑

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

**–§–∞–π–ª**: `src/components/project-modal.tsx`

**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏**: 52-96

**–î–æ–±–∞–≤–ª–µ–Ω–æ**:
- `const prevOpenRef = React.useRef(false)` (—Å—Ç—Ä–æ–∫–∞ 54)
- –£—Å–ª–æ–≤–∏–µ `if (open && !prevOpenRef.current)` (—Å—Ç—Ä–æ–∫–∞ 76)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `prevOpenRef.current = open` (—Å—Ç—Ä–æ–∫–∞ 95)

**–£–¥–∞–ª–µ–Ω–æ**:
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `existingProject` –∏–∑ –º–∞—Å—Å–∏–≤–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π useEffect

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ useEffect**: `[open, isEditMode, projectId, projects]`

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
- ‚ùå –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–±—Ä–∞—Å—ã–≤–∞–ª–∏—Å—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–ª–∏–∫–µ
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –±—ã–ª–æ –≤—ã–±—Ä–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
- ‚ùå useEffect –∑–∞–ø—É—Å–∫–∞–ª—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ projects

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
- ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏
- ‚úÖ –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- ‚úÖ useEffect –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
- ‚úÖ –§–æ—Ä–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –≤–æ –≤—Ä–µ–º—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ CodeQL scan: 0 —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ª–æ–≥–∏–∫–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –¢–æ–ª—å–∫–æ —É–ª—É—á—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

## üìù –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `src/components/project-modal.tsx` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω useEffect
- –õ–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –æ—Å—Ç–∞–ª–∞—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- API –º–µ—Ç–æ–¥—ã –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã

## üöÄ Commit

**Commit**: 42209c5  
**–°–æ–æ–±—â–µ–Ω–∏–µ**: Fix category selection reset issue in project modal  
**–î–∞—Ç–∞**: 2025-11-09  

---

**–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞! –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. ‚úÖ**
